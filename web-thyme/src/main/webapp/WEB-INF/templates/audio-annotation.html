<html xmlns:th="http://www.thymeleaf.org">

<link rel="stylesheet" type="text/css" href="resources/css/audio-annotation.css"/>

<head>
    <title>Welcome to AudioAnnotation</title>

    <script src="resources/javascript/selectionOverlay.js"></script>
    <script src="resources/javascript/waveForm.js"  type="text/javascript"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<script type="text/javascript" charset="utf-8">
    //<![CDATA[

    var selectionOverlay;

    function createComment() {
        console.log( "creating comment" );

        if ( selectionOverlay.startX > -1 ) {
            console.log( "creating region from " + selectionOverlay.startX + " to " + selectionOverlay.endX );
        }
    }

    function loadWaveform( idIndexFile ) {
        this.idCurrentIndexFile = idIndexFile;
        //idCurrentIndexFile = "small";

        console.log( "loading waveform: " + idIndexFile );

        //waveform.width    = window.innerWidth - 100;
        //waveform.height   = 400;

        // TODO:  If there are previous samples, then scale before loading

        $.getJSON( "visualData", { idIndexFile: encodeURI( idIndexFile ), width: waveform.width, height: waveform.height }, function( data ) {
            // data.samples are the values of the waveform starting from a center
            console.log( "We have some shit!" );

            loading( true );

            drawWaveForm( waveform, data.samples );

            loading( false );
        } );
    }

    function loading( isVisible ) {
        if ( isVisible ) {
            loading.style = "visible : visible";
        } else {
            loading.style = "visible : hidden";
        }
    }

    $( window ).resize( function( e ) {
        loadWaveform();
    } );

    $( document ).ready( function() {
        selectionOverlay = new SelectionOverlay( overlay );

        resetCanvas( waveform );
    } );

    //]]>
</script>

<body>

<div class="container">
    <div class="inner-container">
        <div class="waveform">
            <canvas id="waveform"></canvas>
        </div>
        <div class="overlay">
            <canvas id="overlay"></canvas>
        </div>
    </div>
</div>

<input id="commentButton" type="button" value="Comment" onclick="window.createComment();"/>

<div th:unless="${#lists.isEmpty(allIndexFiles)}">
    <p th:each="indexFile : ${allIndexFiles}">
        <a href="javascript:void(0);" th:onclick="'javascript:loadWaveform( \'' + ${ indexFile.id} + '\');'">
            <div class="index-file-list-element">
                <span th:text="${indexFile.name}"/>
            </div>
        </a>
    </p>
</div>


</body>
</html>